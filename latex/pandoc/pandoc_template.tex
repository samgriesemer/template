% document setup
\documentclass{article}
\usepackage[left=1.3in, right=1.3in, top=1.3in, bottom=1.3in]{geometry}


% markdown overrides
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}


\usepackage{fancyhdr}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

% fonts
\usepackage[T1]{fontenc}
$if(fontfamily)$
\usepackage[$for(fontfamilyoptions)$$fontfamilyoptions$$sep$,$endfor$]{$fontfamily$}
$else$
\usepackage[fulloldstyle]{kpfonts}
$endif$

% packages
\usepackage{hyperref}
\usepackage{multirow}
\usepackage{array}
\usepackage{booktabs}
\usepackage{microtype}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{stmaryrd}
\usepackage[shortlabels]{enumitem}
\usepackage{graphicx,grffile}
\graphicspath{{/}}
\usepackage[dvipsnames,svgnames*,x11names*]{xcolor}
\usepackage{framed}


% math packages
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
%\usepackage{mathspec}
\usepackage{bm}
%\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{nicefrac}
%\usepackage{minted}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{tikz}
\usepackage{tikz-qtree}
\usetikzlibrary{shadows,arrows.meta,positioning,backgrounds,fit,chains,scopes,shapes}

% code
\usepackage{listings}

\lstset{
  %% text color and size %%
  backgroundcolor=\color{lightgray},   % choose the background color
  basicstyle=\footnotesize\color{darkgray},        % size of fonts used for the code
  commentstyle=\color{base1},    % comment style
  keywordstyle=\color{sred},       % keyword style
  stringstyle=\color{scyan},     % string literal style
  numberstyle=\scriptsize\color{black},
  %% other styles %%
  breaklines=true,                 % automatic line breaking only at whitespace
  captionpos=b,                    % sets the caption-position to bottom
  %escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  %% numbers %%
  numbers=left,
  stepnumber=1,
  columns=fixed,
  %numbersep=12pt,
  %% frame %%
  frame=lines,
  framexleftmargin=1em,
  framexrightmargin=1em,
  xleftmargin=1em,
  xrightmargin=1em
}

% doesnt work
\newcommand{\passthrough}[1]{\lstset{mathescape=false}#1\lstset{mathescape=true}}

% plotting 
\usepackage{pgfplots}
\pgfplotsset{
  compat=newest,
  plot coordinates/math parser=false,
  tick label style={font=\footnotesize, /pgf/number format/fixed},
  label style={font=\small},
  legend style={font=\small},
  every axis/.append style={
    tick align=outside,
    clip mode=individual,
    scaled ticks=false,
    thick,
    tick style={semithick, black}
  }
}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{dateplot}

% custom math operators
\DeclareMathOperator*{\argmin}{\arg\!\min}
\DeclareMathOperator*{\argmax}{\arg\!\max}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\renewcommand{\vec}[1]{\mathbf{#1}} % overriding vector

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{conj}[theorem]{Conjecture}

% colors
\definecolor{lightgray}{rgb}{0.97, 0.97, 0.97}
\definecolor{darkgray}{rgb}{0.15, 0.15, 0.15}

\definecolor{base3}{HTML}{FDF6E3}
\definecolor{base2}{HTML}{EEE8D5}
\definecolor{base1}{HTML}{93A1A1}
\definecolor{base00}{HTML}{657B83}
\definecolor{base03}{HTML}{002b36}

\definecolor{syellow}{HTML}{B58900}
\definecolor{sorange}{HTML}{CB4B16}
\definecolor{sred}{HTML}{DC322F}
\definecolor{smagenta}{HTML}{d33682}
\definecolor{sviolet}{HTML}{6c71c4}
\definecolor{sblue}{HTML}{268BD2}
\definecolor{scyan}{HTML}{2aa198}
\definecolor{sgreen}{HTML}{859900}

%\ifxetex
  % load bidi as late as possible as it modifies e.g. graphicx
  %\usepackage{bidi}
%\fi


\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[$for(microtypeoptions)$$microtypeoptions$$sep$,$endfor$]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}

% page setup
\pagestyle{fancy}
\fancyhf{}
\lhead{\textbf{\rightmark}}
%\chead{\textbf{\title}}
%\rhead{\textbf{Section \thesection}}
\rhead{\leftmark}
\setlength\parindent{0pt} 

$if(title)$
    \title{$title$}
$endif$
$if(subtitle)$
    \usepackage{etoolbox}
    \makeatletter
    \providecommand{\subtitle}[1]{% add subtitle to \maketitle
      \apptocmd{\@title}{\par {\large #1 \par}}{}{}
    }
    \makeatother

    \subtitle{$subtitle$}
$endif$
$if(author)$
    \author{$for(author)$$author$$sep$ \and $endfor$}
$endif$
\date{$date$}


\begin{document}
$if(title)$
    \maketitle
    $if(abstract)$
        \begin{abstract}
            $abstract$
        \end{abstract}
    $endif$
$endif$

$if(toc)$
\setcounter{tocdepth}{$toc-depth$}
\tableofcontents
$endif$

$if(lot)$
\listoftables
$endif$

$if(lof)$
\listoffigures
$endif$

$body$

\end{document}
